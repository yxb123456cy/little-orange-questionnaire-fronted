import{d as Z,u as H,r as z,q as h,k as G,a as V,s as J,c as y,b as e,f as a,w as o,h as v,t as l,j as d,g as p,I as K,v as M,F as Q,x as W,o as f,y as X,z as O,A as Y,B as tt,n as et,C as q,D as st,p as at,G as B,M as g,H as ot,_ as nt}from"./index-0k8HkCPh.js";const it={class:"profile"},lt={class:"profile-container"},rt={class:"profile-card"},ut={class:"profile-header"},dt={class:"avatar-section"},ct=["src","alt"],mt={class:"user-info"},vt={class:"user-title"},pt={class:"username"},ft={class:"email"},_t={class:"user-meta"},gt={class:"meta-item"},bt={class:"meta-item"},yt={class:"user-stats"},kt={class:"stat"},Ct={class:"stat-number"},It={class:"stat"},$t={class:"stat-number"},At={class:"stat"},Dt={class:"stat-number"},ht={class:"profile-actions"},Vt={class:"content-grid"},St={class:"info-card"},Tt={class:"card-header"},wt={class:"card-content"},xt={class:"form-actions"},zt={key:1,class:"info-display"},Mt={class:"info-item"},Ot={class:"info-item"},qt={class:"info-item"},Bt={class:"info-item"},Lt={class:"info-item"},Ut={class:"info-item"},jt={class:"activity-card"},Et={class:"card-header"},Ft={class:"card-content"},Nt={key:0,class:"activity-list"},Pt={class:"activity-icon"},Rt={class:"activity-content"},Zt={class:"activity-text"},Ht={class:"activity-time"},Gt={key:1,class:"empty-state"},Jt={class:"actions-card"},Kt={class:"card-content"},Qt={class:"action-buttons"},Wt=Z({__name:"Profile",setup(Xt){const k=H(),S=G(),b=z(!1),c=h(()=>k.getCurrentUserInfo);c.value||S.push("/login");const n=V({username:c.value?.username||"",email:c.value?.email||"",avatar:c.value?.avatar||"",bio:c.value?.introduction||"",createdAt:c.value?.created_at||new Date().toISOString(),role:c.value?.role||"user",status:c.value?.status||1}),$=V({questionnaires:12,responses:1580,views:8920}),r=V({username:n.username,email:n.email,bio:n.bio});J(c,s=>{s&&(Object.assign(n,{username:s.username,email:s.email,avatar:s.avatar||"",createdAt:s.created_at,role:s.role,status:s.status}),Object.assign(r,{username:s.username,email:s.email,bio:n.bio}))},{immediate:!0});const T=z([{id:1,type:"create",description:"创建了问卷「用户满意度调研」",createdAt:"2024-01-20T10:30:00Z"},{id:2,type:"view",description:"查看了问卷「产品体验调研」的数据分析",createdAt:"2024-01-19T15:20:00Z"},{id:3,type:"star",description:"收藏了模板「员工满意度调研」",createdAt:"2024-01-18T09:15:00Z"}]);function L(s){return{create:B,view:at,star:q}[s]??B}function A(s){return new Date(s).toLocaleDateString("zh-CN")}function U(s){const t=new Date,_=new Date(s),u=t.getTime()-_.getTime(),m=Math.floor(u/(1e3*60*60*24));return m===0?"今天":m===1?"昨天":m<7?`${m}天前`:A(s)}function j(){try{if(!r.username.trim()){g.error("用户名不能为空");return}if(!r.email.trim()){g.error("邮箱不能为空");return}const s={...c.value,username:r.username,email:r.email,updated_at:new Date().toISOString(),introduction:r.bio};k.setCurrentUserInfo(s),Object.assign(n,{username:r.username,email:r.email,bio:r.bio}),b.value=!1,g.success("个人信息已更新")}catch(s){console.error("保存个人信息失败:",s),g.error("保存失败，请重试")}}function E(){const s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=t=>{const _=t.target.files?.[0];if(_){if(_.size>2*1024*1024){g.error("图片大小不能超过2MB");return}const u=new FileReader;u.onload=m=>{const C=m.target?.result;n.avatar=C;const I={...c.value,avatar:C,updated_at:new Date().toISOString()};k.setCurrentUserInfo(I),g.success("头像更新成功")},u.readAsDataURL(_)}},s.click()}function F(){ot.confirm({title:"确认退出登录？",content:"退出后需要重新登录才能访问个人信息",onOk:()=>{k.logOut(),g.success("已退出登录"),S.push("/login")}})}const w=h(()=>n.role==="admin"?"管理员":"普通用户"),x=h(()=>n.status===1?"正常":"禁用");return(s,t)=>{const _=v("a-avatar"),u=v("a-button"),m=v("a-tag"),C=v("IconLogout"),I=v("a-input"),D=v("a-form-item"),N=v("a-textarea"),P=v("a-form"),R=v("a-link");return f(),y("div",it,[e("div",lt,[e("div",rt,[e("div",ut,[e("div",dt,[a(_,{size:120,class:"user-avatar"},{default:o(()=>[e("img",{src:n.avatar||`https://via.placeholder.com/80?text=${encodeURIComponent(n.username.charAt(0))}`,alt:`${n.username}的头像`},null,8,ct)]),_:1}),a(u,{type:"text",class:"change-avatar-btn",onClick:E},{icon:o(()=>[a(p(X))]),default:o(()=>[t[11]||(t[11]=d(" 更换头像 ",-1))]),_:1})]),e("div",mt,[e("div",vt,[e("h2",pt,l(n.username),1),a(m,{color:n.role==="admin"?"red":"blue",class:"role-tag"},{default:o(()=>[d(l(w.value),1)]),_:1},8,["color"])]),e("p",ft,l(n.email),1),e("div",_t,[e("span",gt,[a(p(K),{class:"meta-icon"}),d(" 状态："+l(x.value),1)]),e("span",bt," 注册时间："+l(A(n.createdAt)),1)]),e("div",yt,[e("div",kt,[e("span",Ct,l($.questionnaires),1),t[12]||(t[12]=e("span",{class:"stat-label"},"问卷",-1))]),e("div",It,[e("span",$t,l($.responses),1),t[13]||(t[13]=e("span",{class:"stat-label"},"回答",-1))]),e("div",At,[e("span",Dt,l($.views),1),t[14]||(t[14]=e("span",{class:"stat-label"},"浏览",-1))])])]),e("div",ht,[a(u,{type:"outline",onClick:t[0]||(t[0]=i=>s.$router.push("/settings"))},{icon:o(()=>[a(p(O))]),default:o(()=>[t[15]||(t[15]=d(" 设置 ",-1))]),_:1}),a(u,{type:"outline",status:"danger",onClick:F},{icon:o(()=>[a(C)]),default:o(()=>[t[16]||(t[16]=d(" 退出 ",-1))]),_:1})])])]),e("div",Vt,[e("div",St,[e("div",Tt,[t[17]||(t[17]=e("h3",null,"基本信息",-1)),a(u,{type:"text",onClick:t[1]||(t[1]=i=>b.value=!b.value)},{icon:o(()=>[a(p(Y))]),default:o(()=>[d(" "+l(b.value?"取消":"编辑"),1)]),_:1})]),e("div",wt,[b.value?(f(),M(P,{key:0,model:r,layout:"vertical"},{default:o(()=>[a(D,{label:"用户名",field:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:o(()=>[a(I,{modelValue:r.username,"onUpdate:modelValue":t[2]||(t[2]=i=>r.username=i),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(D,{label:"邮箱",field:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱格式"}]},{default:o(()=>[a(I,{modelValue:r.email,"onUpdate:modelValue":t[3]||(t[3]=i=>r.email=i),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(D,{label:"个人简介"},{default:o(()=>[a(N,{modelValue:r.bio,"onUpdate:modelValue":t[4]||(t[4]=i=>r.bio=i),placeholder:"介绍一下自己...",rows:3},null,8,["modelValue"])]),_:1}),e("div",xt,[a(u,{type:"primary",onClick:j},{default:o(()=>[...t[18]||(t[18]=[d(" 保存 ",-1)])]),_:1}),a(u,{onClick:t[5]||(t[5]=i=>b.value=!1)},{default:o(()=>[...t[19]||(t[19]=[d(" 取消 ",-1)])]),_:1})])]),_:1},8,["model"])):(f(),y("div",zt,[e("div",Mt,[t[20]||(t[20]=e("label",null,"用户名",-1)),e("span",null,l(n.username),1)]),e("div",Ot,[t[21]||(t[21]=e("label",null,"邮箱",-1)),e("span",null,l(n.email),1)]),e("div",qt,[t[22]||(t[22]=e("label",null,"用户角色",-1)),e("span",null,l(w.value),1)]),e("div",Bt,[t[23]||(t[23]=e("label",null,"账户状态",-1)),a(m,{color:n.status===1?"green":"red"},{default:o(()=>[d(l(x.value),1)]),_:1},8,["color"])]),e("div",Lt,[t[24]||(t[24]=e("label",null,"个人简介",-1)),e("span",null,l(n.bio||"暂无简介"),1)]),e("div",Ut,[t[25]||(t[25]=e("label",null,"注册时间",-1)),e("span",null,l(A(n.createdAt)),1)])]))])]),e("div",jt,[e("div",Et,[t[27]||(t[27]=e("h3",null,"最近活动",-1)),a(R,{onClick:t[6]||(t[6]=i=>s.$router.push("/questionnaires"))},{default:o(()=>[...t[26]||(t[26]=[d(" 查看全部 ",-1)])]),_:1})]),e("div",Ft,[T.value.length>0?(f(),y("div",Nt,[(f(!0),y(Q,null,W(T.value,i=>(f(),y("div",{key:i.id,class:"activity-item"},[e("div",Pt,[(f(),M(tt(L(i.type))))]),e("div",Rt,[e("p",Zt,l(i.description),1),e("span",Ht,l(U(i.createdAt)),1)])]))),128))])):(f(),y("div",Gt,[...t[28]||(t[28]=[e("p",null,"暂无活动记录",-1)])]))])]),e("div",Jt,[t[33]||(t[33]=e("div",{class:"card-header"},[e("h3",null,"快捷操作")],-1)),e("div",Kt,[e("div",Qt,[a(u,{type:"outline",size:"large",class:"action-btn",onClick:t[7]||(t[7]=i=>s.$router.push("/questionnaires/create"))},{icon:o(()=>[a(p(et))]),default:o(()=>[t[29]||(t[29]=d(" 创建问卷 ",-1))]),_:1}),a(u,{type:"outline",size:"large",class:"action-btn",onClick:t[8]||(t[8]=i=>s.$router.push("/starred"))},{icon:o(()=>[a(p(q))]),default:o(()=>[t[30]||(t[30]=d(" 星标问卷 ",-1))]),_:1}),a(u,{type:"outline",size:"large",class:"action-btn",onClick:t[9]||(t[9]=i=>s.$router.push("/analytics"))},{icon:o(()=>[a(p(st))]),default:o(()=>[t[31]||(t[31]=d(" 数据分析 ",-1))]),_:1}),a(u,{type:"outline",size:"large",class:"action-btn",onClick:t[10]||(t[10]=i=>s.$router.push("/settings"))},{icon:o(()=>[a(p(O))]),default:o(()=>[t[32]||(t[32]=d(" 账户设置 ",-1))]),_:1})])])])])])])}}}),te=nt(Wt,[["__scopeId","data-v-6f7d32e8"]]);export{te as default};
