import{l as S,r as x,a as q,d as z,u as I,c as N,b as m,e as R,f as o,w as r,g as a,h as n,o as C,I as D,m as E,i as v,j as f,M as w,E as L,_ as Y}from"./index-0k8HkCPh.js";function V(){const l=S().format("YYYY-MM-DD HH:mm:ss");return console.warn("生成时间:",l),l}function j(){const l=Math.floor(1e6+Math.random()*9e6);return console.warn("生成的7位随机数为:",l),l}function B(){const l=x(!1),d=q({username:"",email:"",password:"",confirmPassword:"",agree:!1});return{loading:l,rules:{username:[{required:!0,message:"请输入用户名"},{minLength:2,message:"用户名长度不能少于2位"},{maxLength:20,message:"用户名长度不能超过20位"}],email:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"请输入正确的邮箱格式"}],password:[{required:!0,message:"请输入密码"},{minLength:6,message:"密码长度不能少于6位"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:(g,i)=>{g!==d.password?i("两次输入的密码不一致"):i()}}]},form:d}}const F={class:"register-container"},G={class:"register-card"},H={class:"agreement"},T={class:"login-link"},Q=z({__name:"Register",setup(l){const{loading:d,form:s,rules:g}=B(),i=x(),y=I();async function k({errors:c}){if(c){console.error("注册表单error:",c);return}if(!s.agree){w.warning("请先同意用户协议和隐私政策");return}d.value=!0;try{console.warn("注册信息:",s);const e={id:j(),username:s.username,email:s.email,password_hash:L(s.password),role:"user",status:1,created_at:V(),updated_at:V()},u=y.registerUser(e);console.warn("注册结果:",u),u?w.success("注册成功"):(i.value?.setFields({email:{status:"error",message:"该邮箱已被注册"}}),console.error("注册失败"))}catch(e){console.error(e),w.error("注册失败，请稍后重试")}finally{d.value=!1}}return(c,e)=>{const u=n("a-input"),p=n("a-form-item"),b=n("a-input-password"),U=n("a-checkbox"),_=n("a-link"),M=n("a-button"),P=n("a-form");return C(),N("div",F,[m("div",G,[e[12]||(e[12]=R('<div class="logo-section" data-v-d93fbdf5><div class="logo" data-v-d93fbdf5><span class="logo-icon" data-v-d93fbdf5>🍊</span><span class="logo-text" data-v-d93fbdf5>小橘问卷</span></div><p class="subtitle" style="color:#ff7a00;font-weight:800;" data-v-d93fbdf5> Xiaoju Questionnaire </p><p class="subtitle" style="margin-top:1vh;" data-v-d93fbdf5> 创建您的账号 </p></div>',1)),o(P,{ref_key:"registerFormRef",ref:i,model:a(s),rules:a(g),layout:"vertical",class:"register-form",onSubmit:k},{default:r(()=>[o(p,{field:"username",label:"用户名"},{default:r(()=>[o(u,{modelValue:a(s).username,"onUpdate:modelValue":e[0]||(e[0]=t=>a(s).username=t),placeholder:"请输入用户名",size:"large",prefix:a(D)},null,8,["modelValue","prefix"])]),_:1}),o(p,{field:"email",label:"邮箱"},{default:r(()=>[o(u,{modelValue:a(s).email,"onUpdate:modelValue":e[1]||(e[1]=t=>a(s).email=t),placeholder:"请输入邮箱地址",size:"large",prefix:a(E)},null,8,["modelValue","prefix"])]),_:1}),o(p,{field:"password",label:"密码"},{default:r(()=>[o(b,{modelValue:a(s).password,"onUpdate:modelValue":e[2]||(e[2]=t=>a(s).password=t),placeholder:"请输入密码（至少6位）",size:"large",prefix:a(v)},null,8,["modelValue","prefix"])]),_:1}),o(p,{field:"confirmPassword",label:"确认密码"},{default:r(()=>[o(b,{modelValue:a(s).confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>a(s).confirmPassword=t),placeholder:"请再次输入密码",size:"large",prefix:a(v)},null,8,["modelValue","prefix"])]),_:1}),m("div",H,[o(U,{modelValue:a(s).agree,"onUpdate:modelValue":e[4]||(e[4]=t=>a(s).agree=t)},{default:r(()=>[...e[5]||(e[5]=[f(" 我已阅读并同意 ",-1)])]),_:1},8,["modelValue"]),o(_,{class:"agreement-link"},{default:r(()=>[...e[6]||(e[6]=[f(" 《用户协议》 ",-1)])]),_:1}),e[8]||(e[8]=m("span",null,"和",-1)),o(_,{class:"agreement-link"},{default:r(()=>[...e[7]||(e[7]=[f(" 《隐私政策》 ",-1)])]),_:1})]),o(M,{type:"primary","html-type":"submit",size:"large",class:"register-button",loading:a(d),disabled:!a(s).agree,long:""},{default:r(()=>[...e[9]||(e[9]=[f(" 注册 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["model","rules"]),m("div",T,[e[11]||(e[11]=m("span",null,"已有账号？",-1)),o(_,{href:"/login",class:"login-text"},{default:r(()=>[...e[10]||(e[10]=[f(" 立即登录 ",-1)])]),_:1})])])])}}}),h=Y(Q,[["__scopeId","data-v-d93fbdf5"]]);export{h as default};
